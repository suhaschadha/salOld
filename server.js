// Required Modules
var txcount = 0;
var express = require("express");
var morgan = require("morgan");
var bodyParser = require("body-parser");
var mongojs = require('mongojs');
var favicon = require('serve-favicon');
var dbUrl = require("./config/db");
const DBURL = dbUrl.url;
const address ='0xd9d64b7dc034fafdba5dc2902875a67b5d586420';
var NodeURL = "http://13.126.168.128:22000";
var account = '0xed9d02e382b34818e88b88a309c7fe71e65f419d';
var PrivateTo = "ROAZBWtSacxXQrOe3FGAqJDyJjFePR5ce4TSIzmJ0Bc=";

var app = express();
var port = process.env.PORT || 5000;

var options = {
  index: "login.html"
};
app.use(express.static(__dirname + '/public'));
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());

require('./app/routes')(app);
require('./app/Contractroutes')(app);
require('./app/paymentroute')(app);
var abi = require("./config/abidefinition");

app.use(favicon(__dirname + '/public/Images/icon_favicons.ico'));

app.use(morgan("dev"));
//error hadler
app.use(function (err, req, res, next) {
  console.error(err.stack)
  res.status(500).send('Something broke!')
});
process.on('uncaughtException', function (err) {
  console.log(err);
});

// Start Server
var server = app.listen(port, function () {
  console.log("Express server listening on port " + port);
});

//Code to push data into the 1 smart contracts(Tx4) related to temprature breach
var Web3 = require('web3');
var io = require('socket.io').listen(server);

setInterval(SendTempratureData, 9000);
function SendTempratureData(){
console.log("see block");
      if (typeof web3 !== 'undefined') { web3 = new Web3(web3.currentProvider); }
      else { web3 = new Web3(new Web3.providers.HttpProvider(NodeURL)); }
          var abi = [{"constant":false,"inputs":[{"name":"TempratureBreached_Data","type":"string"}],"name":"setTempratureBreached","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getTranactiosn1Data","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTempratureBreached","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"Tranactiosn1Temprature","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"Tranactiosn1Data","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTranactiosn1Temprature","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"Tranactiosn1Temprature_Data","type":"string"}],"name":"setTranactiosn1Temprature","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"TempratureBreached","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"Tranactiosn1_Data","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];
       var MyContract = web3.eth.contract(abi).at(address);
      var flag =MyContract.TempratureBreached();
      console.log(flag);
      if (flag == 'yes') {
        io.emit('realtime message', 'yes');
      }
      else if (flag == 'almost') {
        io.emit('realtime message', 'almost');
      }
      else { io.emit('realtime message', 'no'); }
      var db = mongojs(DBURL, ['IoTData']);
      try {
        var flag="yes";
        var flagamber="yes";
        db.IoTData.findOne({ $and: [{ 'deviceId': 'Raspberry Pi-1' }, { 'temperature': { $gt: 26 , $lt: 30 } }] }, function (err, doc) {
          if (typeof web3 !== 'undefined') { web3 = new Web3(web3.currentProvider); }
          else { web3 = new Web3(new Web3.providers.HttpProvider(NodeURL)); }
          var abi = [{"constant":false,"inputs":[{"name":"TempratureBreached_Data","type":"string"}],"name":"setTempratureBreached","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getTranactiosn1Data","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTempratureBreached","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"Tranactiosn1Temprature","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"Tranactiosn1Data","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTranactiosn1Temprature","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"Tranactiosn1Temprature_Data","type":"string"}],"name":"setTranactiosn1Temprature","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"TempratureBreached","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"Tranactiosn1_Data","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];
          var MyContract = web3.eth.contract(abi).at(address);
          if (doc) {
             flagamber = MyContract.TempratureBreached();             
            if (flagamber != 'yes') { 
              MyContract.setTempratureBreached('almost', { from: web3.eth.coinbase, gas: 60000000, privateFor: [PrivateTo] });
             }
          }
        db.close();
        });
        db.IoTData.findOne({ $and: [{ 'deviceId': 'Raspberry Pi-1' }, { 'temperature': { $gt: 30 } }] }, function (err, doc) {
          if (typeof web3 !== 'undefined') { web3 = new Web3(web3.currentProvider); }
          else { web3 = new Web3(new Web3.providers.HttpProvider(NodeURL)); }
          var abi = [{"constant":false,"inputs":[{"name":"TempratureBreached_Data","type":"string"}],"name":"setTempratureBreached","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getTranactiosn1Data","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTempratureBreached","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"Tranactiosn1Temprature","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"Tranactiosn1Data","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTranactiosn1Temprature","outputs":[{"name":"retVal","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"Tranactiosn1Temprature_Data","type":"string"}],"name":"setTranactiosn1Temprature","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"TempratureBreached","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"Tranactiosn1_Data","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];
          var MyContract = web3.eth.contract(abi).at(address);
          if (doc) {
             flag = MyContract.TempratureBreached();
            if (flag != 'yes') { MyContract.setTempratureBreached('yes', { from: web3.eth.coinbase, gas: 60000000, privateFor: [PrivateTo] }); x=0;}
          }
          else if(flag == 'yes' && flagamber == 'yes') { MyContract.setTempratureBreached('no', { from: web3.eth.coinbase, gas: 60000000, privateFor: [PrivateTo] }); }
         db.close();
          });                  
      }
      catch (err) {
        console.log('Something went wrong:' + err)
      }
  
}

//Code to publish all the 6 transctions into blockchain contracts
var tcount;
for (tcount = 1; tcount <= 6; tcount++) {
  var time = tcount;
  time = time * tcount * 900;
  console.log(time);
  setTimeout(myFunction1, time);
var count =0;
  function myFunction1() {
console.log('count:'+ count);
    count = count + 1;
    var path = './contract/DataContractTx' + count.toString() + '.sol'
    var bitecode = '';
    var abidef ;
    if (count==1) {abidef = abi.SandLTx1Data; bitecode ="0x6060604052341561000f57600080fd5b604051610ad6380380610ad6833981016040528080518201919050508060009080519060200190610041929190610096565b50602060405190810160405280600081525060019080519060200190610068929190610096565b5060206040519081016040528060008152506002908051906020019061008f929190610096565b505061013b565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100d757805160ff1916838001178555610105565b82800160010185558215610105579182015b828111156101045782518255916020019190600101906100e9565b5b5090506101129190610116565b5090565b61013891905b8082111561013457600081600090555060010161011c565b5090565b90565b61098c8061014a6000396000f30060606040526004361061008e576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636d557e84146100935780637dac89db146100f05780639d2913b51461017e578063a78ecbbe1461020c578063aa1c11131461029a578063bc95a18114610328578063edefff82146103b6578063efa18b3314610413575b600080fd5b341561009e57600080fd5b6100ee600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506104a1565b005b34156100fb57600080fd5b6101036104bb565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610143578082015181840152602081019050610128565b50505050905090810190601f1680156101705780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561018957600080fd5b610191610563565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101d15780820151818401526020810190506101b6565b50505050905090810190601f1680156101fe5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561021757600080fd5b61021f61060b565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561025f578082015181840152602081019050610244565b50505050905090810190601f16801561028c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156102a557600080fd5b6102ad6106a9565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102ed5780820151818401526020810190506102d2565b50505050905090810190601f16801561031a5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561033357600080fd5b61033b610747565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561037b578082015181840152602081019050610360565b50505050905090810190601f1680156103a85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156103c157600080fd5b610411600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506107ef565b005b341561041e57600080fd5b610426610809565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561046657808201518184015260208101905061044b565b50505050905090810190601f1680156104935780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b80600290805190602001906104b79291906108a7565b5050565b6104c3610927565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105595780601f1061052e57610100808354040283529160200191610559565b820191906000526020600020905b81548152906001019060200180831161053c57829003601f168201915b5050505050905090565b61056b610927565b60028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106015780601f106105d657610100808354040283529160200191610601565b820191906000526020600020905b8154815290600101906020018083116105e457829003601f168201915b5050505050905090565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106a15780601f10610676576101008083540402835291602001916106a1565b820191906000526020600020905b81548152906001019060200180831161068457829003601f168201915b505050505081565b60008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561073f5780601f106107145761010080835404028352916020019161073f565b820191906000526020600020905b81548152906001019060200180831161072257829003601f168201915b505050505081565b61074f610927565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107e55780601f106107ba576101008083540402835291602001916107e5565b820191906000526020600020905b8154815290600101906020018083116107c857829003601f168201915b5050505050905090565b80600190805190602001906108059291906108a7565b5050565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561089f5780601f106108745761010080835404028352916020019161089f565b820191906000526020600020905b81548152906001019060200180831161088257829003601f168201915b505050505081565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106108e857805160ff1916838001178555610916565b82800160010185558215610916579182015b828111156109155782518255916020019190600101906108fa565b5b509050610923919061093b565b5090565b602060405190810160405280600081525090565b61095d91905b80821115610959576000816000905550600101610941565b5090565b905600a165627a7a723058201a79c0051595c9bd93bdcc492a404eedef942e0c9f7db2f9dbb385ef7b9399ac0029";}
    if (count==2) {abidef = abi.SandLTx2Data; bitecode ="0x6060604052341561000f57600080fd5b604051610ad6380380610ad6833981016040528080518201919050508060009080519060200190610041929190610096565b50602060405190810160405280600081525060019080519060200190610068929190610096565b5060206040519081016040528060008152506002908051906020019061008f929190610096565b505061013b565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100d757805160ff1916838001178555610105565b82800160010185558215610105579182015b828111156101045782518255916020019190600101906100e9565b5b5090506101129190610116565b5090565b61013891905b8082111561013457600081600090555060010161011c565b5090565b90565b61098c8061014a6000396000f30060606040526004361061008e576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630c6330f6146100935780636d557e84146101215780636de4b35f1461017e5780639d2913b51461020c578063a114cefd1461029a578063d87ce40f146102f7578063e843264f14610385578063efa18b3314610413575b600080fd5b341561009e57600080fd5b6100a66104a1565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100e65780820151818401526020810190506100cb565b50505050905090810190601f1680156101135780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561012c57600080fd5b61017c600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610549565b005b341561018957600080fd5b610191610563565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101d15780820151818401526020810190506101b6565b50505050905090810190601f1680156101fe5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561021757600080fd5b61021f610601565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561025f578082015181840152602081019050610244565b50505050905090810190601f16801561028c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156102a557600080fd5b6102f5600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506106a9565b005b341561030257600080fd5b61030a6106c3565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561034a57808201518184015260208101905061032f565b50505050905090810190601f1680156103775780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561039057600080fd5b61039861076b565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103d85780820151818401526020810190506103bd565b50505050905090810190601f1680156104055780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561041e57600080fd5b610426610809565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561046657808201518184015260208101905061044b565b50505050905090810190601f1680156104935780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6104a96108a7565b60008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561053f5780601f106105145761010080835404028352916020019161053f565b820191906000526020600020905b81548152906001019060200180831161052257829003601f168201915b5050505050905090565b806002908051906020019061055f9291906108bb565b5050565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105f95780601f106105ce576101008083540402835291602001916105f9565b820191906000526020600020905b8154815290600101906020018083116105dc57829003601f168201915b505050505081565b6106096108a7565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561069f5780601f106106745761010080835404028352916020019161069f565b820191906000526020600020905b81548152906001019060200180831161068257829003601f168201915b5050505050905090565b80600190805190602001906106bf9291906108bb565b5050565b6106cb6108a7565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107615780601f1061073657610100808354040283529160200191610761565b820191906000526020600020905b81548152906001019060200180831161074457829003601f168201915b5050505050905090565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156108015780601f106107d657610100808354040283529160200191610801565b820191906000526020600020905b8154815290600101906020018083116107e457829003601f168201915b505050505081565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561089f5780601f106108745761010080835404028352916020019161089f565b820191906000526020600020905b81548152906001019060200180831161088257829003601f168201915b505050505081565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106108fc57805160ff191683800117855561092a565b8280016001018555821561092a579182015b8281111561092957825182559160200191906001019061090e565b5b509050610937919061093b565b5090565b61095d91905b80821115610959576000816000905550600101610941565b5090565b905600a165627a7a7230582060c2765e58ccb30f1ca3bb2e4c6b57f8cd888c13527581fbab42785a3eb9691a0029";}
    if (count==3) {abidef = abi.SandLTx3Data; bitecode ="0x6060604052341561000f57600080fd5b604051610ad6380380610ad6833981016040528080518201919050508060009080519060200190610041929190610096565b50602060405190810160405280600081525060019080519060200190610068929190610096565b5060206040519081016040528060008152506002908051906020019061008f929190610096565b505061013b565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100d757805160ff1916838001178555610105565b82800160010185558215610105579182015b828111156101045782518255916020019190600101906100e9565b5b5090506101129190610116565b5090565b61013891905b8082111561013457600081600090555060010161011c565b5090565b90565b61098c8061014a6000396000f30060606040526004361061008e576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063199cf98b146100935780633e4a5f4f1461012157806344c9d056146101af5780636d557e841461023d5780638db70d021461029a5780639d2913b514610328578063e5ee768c146103b6578063efa18b3314610413575b600080fd5b341561009e57600080fd5b6100a66104a1565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100e65780820151818401526020810190506100cb565b50505050905090810190601f1680156101135780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561012c57600080fd5b61013461053f565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610174578082015181840152602081019050610159565b50505050905090810190601f1680156101a15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156101ba57600080fd5b6101c26105e7565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102025780820151818401526020810190506101e7565b50505050905090810190601f16801561022f5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561024857600080fd5b610298600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061068f565b005b34156102a557600080fd5b6102ad6106a9565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102ed5780820151818401526020810190506102d2565b50505050905090810190601f16801561031a5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561033357600080fd5b61033b610747565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561037b578082015181840152602081019050610360565b50505050905090810190601f1680156103a85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156103c157600080fd5b610411600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506107ef565b005b341561041e57600080fd5b610426610809565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561046657808201518184015260208101905061044b565b50505050905090810190601f1680156104935780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105375780601f1061050c57610100808354040283529160200191610537565b820191906000526020600020905b81548152906001019060200180831161051a57829003601f168201915b505050505081565b6105476108a7565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105dd5780601f106105b2576101008083540402835291602001916105dd565b820191906000526020600020905b8154815290600101906020018083116105c057829003601f168201915b5050505050905090565b6105ef6108a7565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106855780601f1061065a57610100808354040283529160200191610685565b820191906000526020600020905b81548152906001019060200180831161066857829003601f168201915b5050505050905090565b80600290805190602001906106a59291906108bb565b5050565b60018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561073f5780601f106107145761010080835404028352916020019161073f565b820191906000526020600020905b81548152906001019060200180831161072257829003601f168201915b505050505081565b61074f6108a7565b60028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107e55780601f106107ba576101008083540402835291602001916107e5565b820191906000526020600020905b8154815290600101906020018083116107c857829003601f168201915b5050505050905090565b80600190805190602001906108059291906108bb565b5050565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561089f5780601f106108745761010080835404028352916020019161089f565b820191906000526020600020905b81548152906001019060200180831161088257829003601f168201915b505050505081565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106108fc57805160ff191683800117855561092a565b8280016001018555821561092a579182015b8281111561092957825182559160200191906001019061090e565b5b509050610937919061093b565b5090565b61095d91905b80821115610959576000816000905550600101610941565b5090565b905600a165627a7a723058206f68e7455483ed06cd1445f3e26111ac4d16d12b685dde1ff3df2cb06da741100029";}
    if (count==4) {abidef = abi.SandLTx4Data; bitecode ="0x6060604052341561000f57600080fd5b604051610ad6380380610ad6833981016040528080518201919050508060009080519060200190610041929190610096565b50602060405190810160405280600081525060019080519060200190610068929190610096565b5060206040519081016040528060008152506002908051906020019061008f929190610096565b505061013b565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100d757805160ff1916838001178555610105565b82800160010185558215610105579182015b828111156101045782518255916020019190600101906100e9565b5b5090506101129190610116565b5090565b61013891905b8082111561013457600081600090555060010161011c565b5090565b90565b61098c8061014a6000396000f30060606040526004361061008e576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630980990f146100935780630a771200146101215780634dddb2a0146101af5780636d557e841461023d5780639d2913b51461029a578063a50914c014610328578063b4770a0d14610385578063efa18b3314610413575b600080fd5b341561009e57600080fd5b6100a66104a1565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100e65780820151818401526020810190506100cb565b50505050905090810190601f1680156101135780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561012c57600080fd5b61013461053f565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610174578082015181840152602081019050610159565b50505050905090810190601f1680156101a15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156101ba57600080fd5b6101c26105dd565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102025780820151818401526020810190506101e7565b50505050905090810190601f16801561022f5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561024857600080fd5b610298600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610685565b005b34156102a557600080fd5b6102ad61069f565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102ed5780820151818401526020810190506102d2565b50505050905090810190601f16801561031a5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561033357600080fd5b610383600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610747565b005b341561039057600080fd5b610398610761565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103d85780820151818401526020810190506103bd565b50505050905090810190601f1680156104055780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561041e57600080fd5b610426610809565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561046657808201518184015260208101905061044b565b50505050905090810190601f1680156104935780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105375780601f1061050c57610100808354040283529160200191610537565b820191906000526020600020905b81548152906001019060200180831161051a57829003601f168201915b505050505081565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105d55780601f106105aa576101008083540402835291602001916105d5565b820191906000526020600020905b8154815290600101906020018083116105b857829003601f168201915b505050505081565b6105e56108a7565b60008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561067b5780601f106106505761010080835404028352916020019161067b565b820191906000526020600020905b81548152906001019060200180831161065e57829003601f168201915b5050505050905090565b806002908051906020019061069b9291906108bb565b5050565b6106a76108a7565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561073d5780601f106107125761010080835404028352916020019161073d565b820191906000526020600020905b81548152906001019060200180831161072057829003601f168201915b5050505050905090565b806001908051906020019061075d9291906108bb565b5050565b6107696108a7565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107ff5780601f106107d4576101008083540402835291602001916107ff565b820191906000526020600020905b8154815290600101906020018083116107e257829003601f168201915b5050505050905090565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561089f5780601f106108745761010080835404028352916020019161089f565b820191906000526020600020905b81548152906001019060200180831161088257829003601f168201915b505050505081565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106108fc57805160ff191683800117855561092a565b8280016001018555821561092a579182015b8281111561092957825182559160200191906001019061090e565b5b509050610937919061093b565b5090565b61095d91905b80821115610959576000816000905550600101610941565b5090565b905600a165627a7a72305820bdc99b831b41633a4554412484a1db369468e0d9cbfdc96c00866a9aec0655ff0029";}
    if (count==5) {abidef = abi.SandLTx5Data; bitecode ="0x6060604052341561000f57600080fd5b604051610ad6380380610ad6833981016040528080518201919050508060009080519060200190610041929190610096565b50602060405190810160405280600081525060019080519060200190610068929190610096565b5060206040519081016040528060008152506002908051906020019061008f929190610096565b505061013b565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100d757805160ff1916838001178555610105565b82800160010185558215610105579182015b828111156101045782518255916020019190600101906100e9565b5b5090506101129190610116565b5090565b61013891905b8082111561013457600081600090555060010161011c565b5090565b90565b61098c8061014a6000396000f30060606040526004361061008e576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630f3aaaba146100935780634017a8bd1461012157806348a2a55b1461017e578063658ad9c21461020c5780636d557e841461029a5780639d2913b5146102f7578063c54493e914610385578063efa18b3314610413575b600080fd5b341561009e57600080fd5b6100a66104a1565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100e65780820151818401526020810190506100cb565b50505050905090810190601f1680156101135780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561012c57600080fd5b61017c600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061053f565b005b341561018957600080fd5b610191610559565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101d15780820151818401526020810190506101b6565b50505050905090810190601f1680156101fe5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561021757600080fd5b61021f610601565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561025f578082015181840152602081019050610244565b50505050905090810190601f16801561028c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156102a557600080fd5b6102f5600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061069f565b005b341561030257600080fd5b61030a6106b9565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561034a57808201518184015260208101905061032f565b50505050905090810190601f1680156103775780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561039057600080fd5b610398610761565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103d85780820151818401526020810190506103bd565b50505050905090810190601f1680156104055780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561041e57600080fd5b610426610809565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561046657808201518184015260208101905061044b565b50505050905090810190601f1680156104935780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105375780601f1061050c57610100808354040283529160200191610537565b820191906000526020600020905b81548152906001019060200180831161051a57829003601f168201915b505050505081565b80600190805190602001906105559291906108a7565b5050565b610561610927565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105f75780601f106105cc576101008083540402835291602001916105f7565b820191906000526020600020905b8154815290600101906020018083116105da57829003601f168201915b5050505050905090565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106975780601f1061066c57610100808354040283529160200191610697565b820191906000526020600020905b81548152906001019060200180831161067a57829003601f168201915b505050505081565b80600290805190602001906106b59291906108a7565b5050565b6106c1610927565b60028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107575780601f1061072c57610100808354040283529160200191610757565b820191906000526020600020905b81548152906001019060200180831161073a57829003601f168201915b5050505050905090565b610769610927565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107ff5780601f106107d4576101008083540402835291602001916107ff565b820191906000526020600020905b8154815290600101906020018083116107e257829003601f168201915b5050505050905090565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561089f5780601f106108745761010080835404028352916020019161089f565b820191906000526020600020905b81548152906001019060200180831161088257829003601f168201915b505050505081565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106108e857805160ff1916838001178555610916565b82800160010185558215610916579182015b828111156109155782518255916020019190600101906108fa565b5b509050610923919061093b565b5090565b602060405190810160405280600081525090565b61095d91905b80821115610959576000816000905550600101610941565b5090565b905600a165627a7a723058205b63ea0a46ac763f10aea5ae8cb24b5473a36ffb40e8b8f1ed9dcd5291dfaa8e0029";}
    if (count==6) {abidef = abi.SandLTx6Data; bitecode ="0x6060604052341561000f57600080fd5b604051610ad6380380610ad6833981016040528080518201919050508060009080519060200190610041929190610096565b50602060405190810160405280600081525060019080519060200190610068929190610096565b5060206040519081016040528060008152506002908051906020019061008f929190610096565b505061013b565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100d757805160ff1916838001178555610105565b82800160010185558215610105579182015b828111156101045782518255916020019190600101906100e9565b5b5090506101129190610116565b5090565b61013891905b8082111561013457600081600090555060010161011c565b5090565b90565b61098c8061014a6000396000f30060606040526004361061008e576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806332b9ff1f146100935780636d557e84146101215780639d2913b51461017e578063a60c50a51461020c578063d7806e0c1461029a578063dd86632d146102f7578063e4efcf7614610385578063efa18b3314610413575b600080fd5b341561009e57600080fd5b6100a66104a1565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100e65780820151818401526020810190506100cb565b50505050905090810190601f1680156101135780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561012c57600080fd5b61017c600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061053f565b005b341561018957600080fd5b610191610559565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101d15780820151818401526020810190506101b6565b50505050905090810190601f1680156101fe5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561021757600080fd5b61021f610601565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561025f578082015181840152602081019050610244565b50505050905090810190601f16801561028c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156102a557600080fd5b6102f5600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061069f565b005b341561030257600080fd5b61030a6106b9565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561034a57808201518184015260208101905061032f565b50505050905090810190601f1680156103775780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561039057600080fd5b610398610761565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103d85780820151818401526020810190506103bd565b50505050905090810190601f1680156104055780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561041e57600080fd5b610426610809565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561046657808201518184015260208101905061044b565b50505050905090810190601f1680156104935780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105375780601f1061050c57610100808354040283529160200191610537565b820191906000526020600020905b81548152906001019060200180831161051a57829003601f168201915b505050505081565b80600290805190602001906105559291906108a7565b5050565b610561610927565b60028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105f75780601f106105cc576101008083540402835291602001916105f7565b820191906000526020600020905b8154815290600101906020018083116105da57829003601f168201915b5050505050905090565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106975780601f1061066c57610100808354040283529160200191610697565b820191906000526020600020905b81548152906001019060200180831161067a57829003601f168201915b505050505081565b80600190805190602001906106b59291906108a7565b5050565b6106c1610927565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107575780601f1061072c57610100808354040283529160200191610757565b820191906000526020600020905b81548152906001019060200180831161073a57829003601f168201915b5050505050905090565b610769610927565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107ff5780601f106107d4576101008083540402835291602001916107ff565b820191906000526020600020905b8154815290600101906020018083116107e257829003601f168201915b5050505050905090565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561089f5780601f106108745761010080835404028352916020019161089f565b820191906000526020600020905b81548152906001019060200180831161088257829003601f168201915b505050505081565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106108e857805160ff1916838001178555610916565b82800160010185558215610916579182015b828111156109155782518255916020019190600101906108fa565b5b509050610923919061093b565b5090565b602060405190810160405280600081525090565b61095d91905b80821115610959576000816000905550600101610941565b5090565b905600a165627a7a7230582083f4e159b4fe602802c503cdaec5709403915032b7ec8b64ef7181a6e6bedcee0029";}
//   SALDemoCode(path,bitecode,abidef);
  }

}

function SALDemoCode(path , bitecode,abidef) {
  var fs = require('fs');
  var contractPath = path;

  fs.readFile(contractPath, 'utf8', function read(err, data) {
    if (err) {
      throw err;
    }
    var contractcontent = bitecode;
    if (typeof web3 !== 'undefined') { web3 = new Web3(web3.currentProvider); }
    else { web3 = new Web3(new Web3.providers.HttpProvider(NodeURL)); }
    web3.eth.defaultAccount = account;
    var abiDefinition =abidef;
    var simpleContract = web3.eth.contract(abiDefinition);
    var simple = simpleContract.new("Tranactiosn1_Data", { from: web3.eth.defaultAccount, data: contractcontent, gas: 30000000, privateFor: [PrivateTo] }, function (e, contract) {
      if (e) {
        console.log("err creating contract:", e);
      } else {
        if (!contract.address) {
          var transactionHash = contract.transactionHash;
         var contractaddress = contract.address;
          console.log("Contract transaction send: TransactionHash: " + contract.transactionHash + " waiting to be mined...");
        } else {
          var transactionHash = contract.transactionHash;
          var contractaddress = contract.address;
          console.log("Contract mined! Address: " + contract.address);
          //Save all the contract details in MongoDB
          var mongojs = require('mongojs');
          var db = mongojs(DBURL, ['SmartContractSAL']);
          console.log('txcount:' + txcount);
          txcount++;
          var cData = { 'bolid': 'tX' + txcount.toString(), 'abi': abiDefinition, 'contractaddress': contractaddress, 'contracthash': transactionHash };
          db.SmartContractSAL.insert(cData, function (err, doc) {
            if (err) { console.log(" Woops! The error took place here... "); }
            else { }
          });
        }
      }
    });
  });
}
//0x7e4255a77f5470ac83b7c69b017c7824434267e3
